# 序云FS / JAWN-FS

Japanese Web Novel Foundational Syntax.

日本のウェブ小説サービスに投稿するための基礎構文。

## これは？

小説投稿サイトはいくつもありますが、それぞれ微妙に記法や制限が異なっているのが現状です。  
そんな中、複数のサイトに投稿するのは手間がかかります。

ならば1つの構文を書くサイト向けに変換すればいいのではないかという発想から作られたものが序云FSです。

## 記法

### ルビ

多くのサイトで用いられている青空文庫記法を採用しています。

```text
｜親文字《ルビ文字》
```

全角`｜`または半角`|`（以降バーティカルバーと呼びます）でルビの始まりを示し、`《`と`》`で囲まれた文字をルビ文字とします。

#### エスケープ

文中にバーティカルバーと`《`が出てくるがルビではないという場合、`《`の直前にバーティカルバーを配置します。

次のように表示したい場合。

```text
ルビじゃない｜親文字《ルビ文字》
```

以下のように記述します。

```text
ルビじゃない｜親文字｜《ルビ文字》
```

文中にバーティカルバーが出てこない場合は、そのまま記述して構いません。

```text
なにか文字《ルビ文字じゃない》
```

不安な場合、すべての`《`の直前にバーティカルバーを配置しても構いません。`｜《`は強制的に`《`に変換され、通常のテキストとして扱われます。

#### 自動ルビについて

いくつかのサイトが採用しているような、バーティカルバーの省略はできません。

##### なぜですか？

いくつかの投稿サイトでは漢字が連続した後に`《》`や`（）`を使うと自動的にルビになる、といった記法が採用されていますが、サイトによって「漢字」の指す範囲が異なります。そのため、どのサイトを主に利用しているかによって自動ルビの感覚が異なります。  
現実に、予期せずルビになったと思われるテキスト、逆にルビになるはずがなっていないテキストを見かけます。  
そういった事態を避けるため、ルビ記法は厳密にバーティカルバーで始めることにしています。

### 強調（圏点または傍点）

カクヨムなど、いくつかのサイトが使用している記法を採用しています。  
強調されたテキストは圏点（傍点）が付与されることが期待されます。

```text
《《強調文字》》
```

サイトによっては、強調専用の記法が存在せず、圏点はモノルビで代用するようになっています。  
この強調構文を使うことで、その手間を省けます。

#### エスケープ

文中に連続する二重山括弧`《《`が出てくるが、強調ではないという場合は`《《`の直前にバーティカルバーを配置します。

次のように表示したい場合。

```text
《《強調じゃない！》》
```

以下のように記述します。

```text
｜《《強調じゃない！》》
```

さらに多く重ねたい場合、内側から2個ごとにバーティカルバーを配置してください。

```text
《｜《《｜《《｜《《強調じゃない！》》》》》》》
```

考えるのが面倒な場合、すべての`《`の直前にバーティカルバーを配置しても構いません。`｜《`は強制的に`《`に変換され、通常のテキストとして扱われます。

#### 強調構文内のルビ

```text
《《｜強調《きょうちょう》｜文字《もじ》》》
```

このように強調内でルビを使用できますが、投稿サイトでは併用できないと思われますので、意図した結果にはならないでしょう。現実に、カクヨムでこの記法は使えますが、ルビが優先されます。  
強調構文の存在しないサイトではなおのことです。

HTML変換の場合、CSSで指定しておけば、ウェブブラウザーによってはルビと圏点の両方を表示してくれるでしょう。  
どちらかしか表示されない環境もありますので、そういった点からも意図した結果にならないと言えます。

##### どうして強調内のルビが許されるのですか？

各サイトの解釈は分かりませんが、序云FSでは文法的におかしくないという理由で許可しています。

```text
「急いで！」
```

という文を強調しつつルビを振るとして、このとき`いで`だけを強調したいということはめったにないでしょう。  

```
「｜急《いそ》《《いで》》！」
```

よりも

```
「《《｜急《いそ》いで》》！」
```

のほうが自然です。

サイトの制限で奇妙な文になるよりも、自然なほうを選択したほうがよいという考えからです。

## 変換ツール

作成中です。

## textlint使用者向け

- [textlint-plugin-jawn](https://github.com/matori/textlint-plugin-jawn)  
  序云FSを[textlint](https://github.com/textlint/textlint)で扱えるようにするためのプラグイン。
- [textlint-rule-max-ruby-len](https://github.com/matori/textlint-rule-max-ruby-len)  
  ルビ親文字とルビ文字の最大数を制限する[textlint](https://github.com/textlint/textlint)ルール。

## 開発者向け

- [jawn-to-ast](https://github.com/matori/jawn-to-ast)  
  序云FSを[textlint](https://github.com/textlint/textlint)互換のASTにパースするライブラリ。
